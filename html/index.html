<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Abstractify</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="/assets/pico.min.css" rel="stylesheet" />
    <link rel="stylesheet" type="text/css" href="https://unpkg.com/notie/dist/notie.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Cedarville+Cursive&display=swap" rel="stylesheet">
    <style>
      .notie-container{
        font-size: 1rem;
      }
    </style>
  </head>
  <body>
    <main class="container">
      <section>
        <div id="intro">
          <a href="/" style="color: black; text-decoration: none;"><h1 style="font-family: 'Cedarville Cursive', cursive;">Abstractify</h1></a>
          <img src="/assets/wallpaper.png" alt="sample image">
        </div>
      </section>
      <section>
        <div id="form">
          <p>Abstractify is a simple app that creates an abstracted version of your image.</p>
          <p>Give it a try! <br><br>(In my experimentation, I have found that images depicting landscapes or scenery seem to yield the most aesthetically pleasing results, but feel free to try out any image you like!)</p>
          <form id="form" action="/upload" enctype="multipart/form-data" method="POST" >
            <div>
                <input id="upload" type="file" name="uploadFile" />
            </div>
            <div>
              <p>Make sure that your image file is either a JPG or PNG file and less than 4mb in size.</p>
              <button type="submit" id="submit">Submit</button>
            </div>
          </form>
        </div>
      </section>
    </main>
    {{template "footer"}}
    <script>
      let btn = document.getElementById("submit");
      btn.addEventListener("click", () => {
        let txt = btn.innerText;
        txt = 'Please wait while your image is being processed...';
        btn.setAttribute("aria-busy", "true");
        btn.innerText = txt;
      });
      
      let uploadFile = document.getElementById("upload");
      uploadFile.addEventListener("change", () => {
        let file = uploadFile.files;
        if (file.length > 0) {
          const fileType = file[0].type;
          if (fileType != "image/jpeg" && fileType != "image/png") {
            notie.alert({type: 'error', text:'The selected file does not seem to be an image file. Please try another file.'})
            return btn.disabled = true;
            } else {
                btn.disabled = false;
          }
          const fileSize = file[0].size;
          const fileSizeMB = Math.round((fileSize/1024/1024));
            if (fileSizeMB >4) {
            notie.alert({type: 'error', text:'The selected file exceeds 4mb in size. Please select a smaller file.'})
              return btn.disabled = true;
            } else {
                btn.disabled = false;
            }
        }
      });
    </script>
    <script src="https://unpkg.com/notie"></script>
  </body>
</html>
